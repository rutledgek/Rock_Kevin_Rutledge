<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProjectGuid>{6F95959E-067F-4366-990B-76D5CE7FA760}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>Invoice_System</RootNamespace>
    <AssemblyName>online.kevinrutledge.InvoiceSystem</AssemblyName>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <Deterministic>true</Deterministic>
  </PropertyGroup>
  <PropertyGroup>
    <VersionFile>$(ProjectDir)\builds\.version</VersionFile>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="DotLiquid">
      <HintPath>..\RockWeb\Bin\DotLiquid.dll</HintPath>
    </Reference>
    <Reference Include="EntityFramework">
      <HintPath>..\RockWeb\Bin\EntityFramework.dll</HintPath>
    </Reference>
    <Reference Include="EntityFramework.SqlServer">
      <HintPath>..\RockWeb\Bin\EntityFramework.SqlServer.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Data.Edm, Version=5.8.4.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\RockWeb\Bin\Microsoft.Data.Edm.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Data.OData, Version=5.8.4.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\RockWeb\Bin\Microsoft.Data.OData.dll</HintPath>
    </Reference>
    <Reference Include="Newtonsoft.Json, Version=13.0.1.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\RockWeb\Bin\Newtonsoft.Json.dll</HintPath>
    </Reference>
    <Reference Include="Rock">
      <HintPath>..\RockWeb\Bin\Rock.dll</HintPath>
    </Reference>
    <Reference Include="Rock.Lava.Shared">
      <HintPath>..\RockWeb\Bin\Rock.Lava.Shared.dll</HintPath>
    </Reference>
    <Reference Include="Rock.Rest">
      <HintPath>..\RockWeb\Bin\Rock.Rest.dll</HintPath>
    </Reference>
    <Reference Include="System" />
    <Reference Include="System.ComponentModel.DataAnnotations" />
    <Reference Include="System.Core" />
    <Reference Include="System.Runtime.Serialization" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.Data" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Xml" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Migrations\002_CreateDB_Invoice.cs" />
    <Compile Include="Migrations\001_CreateDB_InvoiceType.cs" />
    <Compile Include="Migrations\003_CreateDB_InvoiceItem.cs" />
    <Compile Include="Migrations\004_CreateDB_SystemCommunications.cs" />
    <Compile Include="Migrations\005_CreateDB_InvoiceAssignment.cs" />
    <Compile Include="Model\InvoiceAssignment_ExtensionMethods.cs" />
    <Compile Include="Model\InvoiceAssignment_Logic.cs" />
    <Compile Include="Model\InvoiceType_Cache.cs" />
    <Compile Include="Model\InvoiceAssignment_Service.cs" />
    <Compile Include="Model\InvoiceAssignment.cs" />
    <Compile Include="Model\InvoiceItem_Service.cs" />
    <Compile Include="Model\InvoiceItem.cs" />
    <Compile Include="Model\Invoice.cs" />
    <Compile Include="Model\InvoiceType.cs" />
    <Compile Include="Model\InvoiceType_Logic.cs" />
    <Compile Include="Model\Invoice_ExtensionMethods.cs" />
    <Compile Include="Model\Invoice_Logic.cs" />
    <Compile Include="Model\Invoice_Service.cs" />
    <Compile Include="Model\InvoiceType_Service.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
    <Compile Include="SystemGuids\SystemGuids.cs" />
  </ItemGroup>
  <ItemGroup>
    <Folder Include="Rest\" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\Rock.Common\Rock.Common.csproj">
      <Project>{13568622-324E-4493-B605-C9896E725D30}</Project>
      <Name>Rock.Common</Name>
    </ProjectReference>
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <PropertyGroup>
    <PostBuildEvent>@echo off
SETLOCAL ENABLEDELAYEDEXPANSION

REM Define paths
SET SolutionDir=$(SolutionDir)
SET ProjectDir=$(ProjectDir)
SET BuildDir=%25SolutionDir%25\..\..\RockProjectBuilds
SET AssemblyName=$(ProjectName)

@echo off


REM Replace first . with _
FOR /F "tokens=1* delims=." %25%25A IN ("%25AssemblyName%25") DO (
    SET TransformedName=%25%25A_%25%25B
)

REM Replace remaining . with \
SET FolderParts=%25TransformedName%25
:replaceLoop
SET FolderParts=%25FolderParts:.=\%25
IF NOT "%25FolderParts%25"=="%25FolderParts:.=%25" GOTO replaceLoop

REM Read the .version file to get the version number
SET VersionFile=%25ProjectDir%25\builds\.version
IF EXIST "%25VersionFile%25" (
    FOR /F "delims=" %25%25V IN (%25VersionFile%25) DO SET VersionNumber=%25%25V
) ELSE (
    echo ERROR: .version file not found!
    pause
    exit /b 1
)

SET FileOutputLocation=%25BuildDir%25\%25FolderParts%25\%25VersionNumber%25


REM Debugging: Print variables
echo SolutionDir = %25SolutionDir%25
echo ProjectDir = %25ProjectDir%25
echo BuildDir = %25BuildDir%25
echo TransformedName = %25FolderParts%25
echo FolderParts = %25FolderParts%25
echo bin = "%25FileOutputLocation%25\content\bin"
echo VersionNumber = %25VersionNumber%25
echo FileOutputLocation = %25FileOutputLocation%25

pause

REM Create folder structure
mkdir "%25FileOutputLocation%25\content\bin"
mkdir "%25FileOutputLocation%25\content\Plugins"
mkdir "%25FileOutputLocation%25\install"
mkdir "%25FileOutputLocation%25\uninstall"

REM Copy the DLL file
xcopy /Y /F "%25ProjectDir%25\bin\Release\%25AssemblyName%25.dll" "%25FileOutputLocation%25\content\bin\"

REM Copy all folders and files recursively within the FolderParts folder
xcopy /Y /E /F "%25SolutionDir%25\RockWeb\Plugins\%25FolderParts%25\*" "%25FileOutputLocation%25\content\Plugins\%25FolderParts%25\"

REM Include version file for install/uninstall
xcopy /Y /H /F "%25ProjectDir%25\builds\.version" "%25FileOutputLocation%25\install"
xcopy /Y /H /F "%25ProjectDir%25\builds\.version" "%25FileOutputLocation%25\uninstall"

REM Compress files into a ZIP

powershell -Command "Compress-Archive -Path '%25FileOutputLocation%25\*' -DestinationPath '%25BuildDir%25\%25TransformedName%25.zip' -Force"
IF ERRORLEVEL 1 (
    echo ERROR: ZIP file creation failed.
    exit /b 1
)
echo ZIP file created successfully.

REM Rename ZIP file to plugin file and move to parent directory
rename "%25BuildDir%25\%25TransformedName%25.zip" "%25TransformedName%25_%25VersionNumber%25.plugin"
move /Y "%25BuildDir%25\%25TransformedName%25_%25VersionNumber%25.plugin" "%25FileOutputLocation%25\"

IF ERRORLEVEL 1 (
    echo ERROR: Plugin file rename or move failed.
    pause
    exit /b 1
)
echo Plugin file created successfully.

REM Complete
echo Build script completed successfully.
pause</PostBuildEvent>
  </PropertyGroup>
</Project>